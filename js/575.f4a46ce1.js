"use strict";(self["webpackChunkdggs_webgis"]=self["webpackChunkdggs_webgis"]||[]).push([[575],{3575:(e,t,a)=>{a.r(t),a.d(t,{default:()=>I});var r=a(3673);function s(e,t,a,s,o,n){const l=(0,r.up)("Map"),i=(0,r.up)("q-page");return(0,r.wg)(),(0,r.j4)(i,{class:"q-pt-lg"},{default:(0,r.w5)((()=>[(0,r._)("div",null,[(0,r.Wm)(l)])])),_:1})}var o=a(2323);const n={class:"q-pa-md"},l={class:"row"},i={class:"col-10"},c={class:"row items-start items-center q-gutter-md q-mb-md"},p={class:"col-2"},d={class:"flex flex-center",style:{height:"50px",position:"relative"}},u={id:"openmap",ref:"map-gis",class:"map-container"};function m(e,t,a,s,m,h){const f=(0,r.up)("q-spinner-ios"),w=(0,r.up)("q-inner-loading");return(0,r.wg)(),(0,r.iD)("div",n,[(0,r._)("div",l,[(0,r._)("div",i,[(0,r._)("div",c,[(0,r._)("div",null,"Map zoom: "+(0,o.zw)(m.mapZoom),1),(0,r._)("div",null," Hexagons quantity: "+(0,o.zw)(m.featuresQuantity)+" at Level: "+(0,o.zw)(m.layerLevel),1),(0,r._)("div",null,"Map extent: "+(0,o.zw)(m.mapExtent),1),(0,r._)("div",null,"Map center: "+(0,o.zw)(h.mapCenterComputed),1)])]),(0,r._)("div",p,[(0,r._)("div",d,[(0,r.Wm)(w,{showing:m.loading},{default:(0,r.w5)((()=>[(0,r.Wm)(f,{color:"primary",size:"30px"})])),_:1},8,["showing"])])])]),(0,r._)("div",u,null,512)])}a(71),a(7098),a(2167);var h=a(921),f=a.n(h),w=a(3081),y=a(5140),g=a(7879),Z=a(2411),v=a(4070),C=a(7263),S=a(5344),x=a(2553),_=a(3489),b=a(5090),M=a(9455),E=a(1314),G=a(7434),k=a.n(G);const P=new _.ZP({fill:new b.Z({color:"rgba(255, 255, 255, 0.6)"}),stroke:new M.Z({color:"#319FD3",width:1}),text:new E.Z({font:"12px Calibri,sans-serif",fill:new b.Z({color:"#000"}),stroke:new M.Z({color:"#fff",width:3})})}),z=new _.ZP({fill:new b.Z({color:"#fff"}),stroke:new M.Z({color:"#319FD3",width:1}),text:new E.Z({font:"12px Calibri,sans-serif",fill:new b.Z({color:"#000"}),stroke:new M.Z({color:"#fff",width:3})})}),R=new _.ZP({fill:new b.Z({color:"#fff"}),stroke:new M.Z({color:"transparent",width:0}),text:new E.Z({font:"12px Calibri,sans-serif",fill:new b.Z({color:"#000"}),stroke:new M.Z({color:"#fff",width:3})})}),V={name:"Map",props:{layer:Object},components:{},data(){return{map:null,mapCenter:[2791191.1823448315,8117240.098736058],mapZoom:6,layers:[],dggsLayersFeatures:[],extent:null,mapExtent:[],featuresQuantity:0,layerLevel:0,loading:!1}},watch:{layerSelectedRasterComputed(e,t){this.createMap()},layersSelectedVectorComputed(e,t){this.createMap()},layerSelectedDGGSComputed(e,t){this.createMap()},mapZoom(e,t){this.$store.commit("layers/SET_MAP_ZOOM",this.mapZoom)}},mounted(){this.createMap()},methods:{async createMap(){this.loading=!0,document.getElementById("openmap").innerHTML="",this.layers=[];const e=new g.Z({name:"osm",type:"raster",source:new Z.Z({url:this.layerSelectedRasterComputed.url,attributions:this.layerSelectedRasterComputed.attributions})});if(this.layers.push(e),this.layersSelectedVectorComputed.length>0&&this.layersSelectedVectorComputed.forEach((e=>{let t=new C.Z({source:new S.Z({url:e.url,format:new x.Z}),style:function(e){return P.getText().setText(e.get("name")),P}});this.layers.push(t)})),this.layerSelectedDGGSComputed.length>0){var t=this.layerSelectedDGGSComputed,a=this.mapExtent.toString();await Promise.all(t.map((async e=>{var t=[];try{t=await this.$axios.get("https://dggs-api-bozea3cspa-ew.a.run.app/dggs-api/collections/"+e.id+"/zones",{params:{resolution:e.level,limit:1e4,bbox:a},headers:{"Content-Type":"application/json"}})}catch(u){console.log("error ",u.message)}let r=t.data.features;var s=[],o=[];r.forEach((e=>{let t=e.id,a=f().h3ToFeature(t);a.properties.id=e.id,a.properties.links=e.links,a.properties.elevation=e.properties.elevation,s.push(a),o.push(e.properties.elevation)}));var n=o.sort(),l=k().limits(n,e.choroplethRangesMode,e.choroplethRanges),i=k().scale(e.choroplethColorPalette).classes(l);this.featuresQuantity=s.length,this.layerLevel=e.level;let c={type:"FeatureCollection",features:s};const p=new S.Z({features:(new x.Z).readFeatures(c,{featureProjection:"EPSG:3857"})}),d=new C.Z({name:e.id,type:"vector",source:p,style:function(t){if(e.choroplethStatus){let e=i(t.get("elevation")).hex();return R.getFill().setColor(e),R}return z},opacity:e.opacity});this.layers.push(d)})))}this.map=new w.Z({target:this.$refs["map-gis"],layers:[],view:new y.ZP({center:this.mapCenter,zoom:this.mapZoom,constrainResolution:!0})}),this.layers.forEach((e=>{let t=this;t.map.addLayer(e)})),this.map.getLayers().forEach((e=>{console.log(e.get("name"))})),this.map.on("moveend",(e=>{let t=e.map;this.mapCenter=t.getView().getCenter(),this.mapZoom=t.getView().getZoom();let a=this.map.getView().calculateExtent(),r=(0,v.$A)(a,"EPSG:3857","EPSG:4326");this.mapExtent=r})),this.loading=!1}},computed:{mapCenterComputed:function(){let e=this.mapCenter,t=(0,v.bU)(e);return t},layersSelectedVectorComputed:function(){return this.$store.state.layers.layersSelectedVector},layerSelectedRasterComputed:function(){return this.$store.state.layers.layerSelectedRaster},layerSelectedDGGSComputed:function(){return this.$store.state.layers.layersSelectedDGGS}}};var L=a(6941),$=a(8506),q=a(7518),D=a.n(q);V.render=m,V.__scopeId="data-v-0f5f30ec";const F=V;D()(V,"components",{QInnerLoading:L.Z,QSpinnerIos:$.Z});const Q={name:"Web-GIS",components:{Map:F},data(){return{}},mounted(){},methods:{},computed:{layersSelectedVectorComputed:function(){return this.$store.state.layers.layersSelectedVector},layerSelectedRasterComputed:function(){return this.$store.state.layers.layerSelectedRaster}}};var T=a(4379);Q.render=s;const I=Q;D()(Q,"components",{QPage:T.Z})}}]);