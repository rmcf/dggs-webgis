"use strict";(self["webpackChunkdggs_webgis"]=self["webpackChunkdggs_webgis"]||[]).push([[893],{6993:(e,t,r)=>{r.d(t,{Z:()=>c});var o=r(3673),a=r(2323);const n={class:"text-body2 q-pt-sm text-right"},s={class:"text-nodecoration",href:"https://www.ut.ee/en"};function l(e,t,r,l,i,c){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",n,[(0,o.Uk)(" Â© Copyright 2021-"+(0,a.zw)(c.year)+" ",1),(0,o._)("a",s,(0,a.zw)(e.$t("university")),1)])])}const i={name:"Footer",components:{},data(){return{}},watch:{},created(){},methods:{},computed:{year:function(){const e=new Date;let t=e.getFullYear();return t}}};i.render=l;const c=i},2893:(e,t,r)=>{r.r(t),r.d(t,{default:()=>B});var o=r(3673);function a(e,t,r,a,n,s){const l=(0,o.up)("Map"),i=(0,o.up)("q-page");return(0,o.wg)(),(0,o.j4)(i,{class:"q-pt-lg"},{default:(0,o.w5)((()=>[(0,o._)("div",null,[(0,o.Wm)(l)])])),_:1})}var n=r(2323);const s=e=>((0,o.dD)("data-v-deb5a672"),e=e(),(0,o.Cn)(),e),l={class:"q-pl-md q-pr-md q-pb-md"},i={class:"row justify-between items-center q-mb-md"},c=s((()=>(0,o._)("sup",null,"2",-1))),p={style:{"padding-right":"100px"}},u={style:{height:"30px",position:"relative"}},h={id:"openmap",ref:"map-gis",class:"map-container"};function m(e,t,r,a,s,m){const d=(0,o.up)("q-spinner-ios"),g=(0,o.up)("q-inner-loading"),f=(0,o.up)("Footer");return(0,o.wg)(),(0,o.iD)("div",l,[(0,o._)("div",i,[(0,o._)("div",null,(0,n.zw)(e.$t("zoom"))+": "+(0,n.zw)(s.mapZoom),1),(0,o._)("div",null,[(0,o.Uk)((0,n.zw)(e.$t("area"))+": "+(0,n.zw)(m.mapAreaComputedFormated)+" km",1),c]),(0,o._)("div",p,[(0,o._)("div",u,[(0,o.Wm)(g,{showing:s.loading},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{color:"primary",size:"30px"})])),_:1},8,["showing"])])])]),(0,o._)("div",h,null,512),(0,o.Wm)(f)])}r(71),r(7098),r(5363);var d=r(6993),g=(r(2167),r(921)),f=r.n(g),y=r(3081),w=r(5140),Z=r(7879),C=r(2411),v=r(3212),S=r(7263),x=r(5344),P=r(9109),b=r(6783),E=r(5149),L=r(9821),_=r(5773),R=r(3489),A=r(5090),F=r(9455),V=r(1314),G=r(7434),z=r.n(G),$=r(4529),M=r(6254);const T=new R.ZP({fill:new A.Z({color:"rgba(255, 255, 255, 0.6)"}),stroke:new F.Z({color:"#319FD3",width:1}),text:new V.Z({font:"12px Calibri,sans-serif",fill:new A.Z({color:"#000"}),stroke:new F.Z({color:"#fff",width:3})})}),k=new R.ZP({fill:new A.Z({color:"#fff"}),stroke:new F.Z({color:"#319FD3",width:1}),text:new V.Z({font:"12px Calibri,sans-serif",fill:new A.Z({color:"#000"}),stroke:new F.Z({color:"#fff",width:3})})}),D=new R.ZP({fill:new A.Z({color:"#0000ff"}),stroke:new F.Z({color:"transparent",width:0}),text:new V.Z({font:"8px Calibri,sans-serif",fill:new A.Z({color:"#000"}),stroke:new F.Z({color:"#fff",width:3})})}),j={name:"Map",components:{Footer:d.Z},data(){return{map:null,mapCenter:[2791191.1823448315,8117240.098736058],mapZoom:null,mapExtent:[],mapArea:null,layers:[],dggsLayersFeatures:[],featuresQuantity:0,layerLevel:0,corners:null,loading:!1}},watch:{layerSelectedRasterComputed(e,t){this.createMap()},layersSelectedVectorComputed(e,t){this.createMap()},layerSelectedDGGSComputed(e,t){this.createMap()},mapZoomAndCenter:{handler(e,t){if(t.zoom!==e.zoom)return this.$store.commit("layers/SET_MAP_ZOOM",this.mapZoom),void this.$store.commit("layers/MAP_AREA",this.mapAreaComputed);let r=e.center.toString()===t.center.toString();r||this.updateMap(this.map)},deep:!0}},created(){},mounted(){this.mapZoom=this.$store.state.layers.zoom,this.createMap()},unmounted(){},methods:{dggsLayerUrl(e,t){return e+":"+t},layerRangeRefine(e,t){return e+","+t},async createMap(){this.loading=!0,this.map=null;var e=this;document.getElementById("openmap").innerHTML="",this.map=new y.Z({target:this.$refs["map-gis"],layers:[],view:new w.ZP({center:this.mapCenter,zoom:this.mapZoom,constrainResolution:!0})});const t=new Z.Z({name:"osm",type:"raster",source:new C.Z({url:this.layerSelectedRasterComputed.url,attributions:this.layerSelectedRasterComputed.attributions})});e.map.addLayer(t),this.loadVectorLayers()},async updateMap(e){this.loading=!0;const t=[...e.getLayers().getArray()];t.forEach((t=>{t&&"vector"===t.get("type")&&e.removeLayer(t)})),this.loadVectorLayers()},async loadVectorLayers(){this.loading=!0;var e=this;this.layersSelectedVectorComputed.length>0&&this.layersSelectedVectorComputed.forEach((t=>{let r=new S.Z({source:new x.Z({url:t.url,format:new P.Z}),style:function(e){return T.getText().setText(e.get("name")),T}});e.map.addLayer(r)}));let t=this.map.getView().calculateExtent(),r=(0,v.$A)(t,"EPSG:3857","EPSG:4326");this.mapExtent=r;var o=[];if(this.layerSelectedDGGSComputed.length>0){var a=this.layerSelectedDGGSComputed,n=this.mapExtent.toString();await Promise.all(a.map((async t=>{var r=[];try{r=await this.$axios.get("https://dggs-api-bozea3cspa-ew.a.run.app/dggs-api/dggs/"+e.dggsLayerUrl(t.crs,t.id)+"/zones",{params:{rangeRefine:e.layerRangeRefine(t.level,10),limit:1e4,bbox:n},headers:{"Content-Type":"application/json"}})}catch(d){this.loading=!1,console.log("error ",d.message)}let a=r.data.features;var s=[],l=[];a.forEach((e=>{let r=f().h3ToFeature(e.id);Object.entries(e.properties).forEach((e=>{const[t,o]=e;r.properties[t]=o})),(t.choroplethParameterZeroValue||""===t.choroplethParameter||r.properties[t.choroplethParameter]>0&&null!==r.properties[t.choroplethParameter])&&s.push(r),l.push(e.properties[t.choroplethParameter])}));var i=[""];a.length>0&&Object.entries(a[0].properties).forEach((e=>{const[t,r]=e;i.push(t)}));var c=l.filter((function(e){return e>0})),p=c.sort();if("continuous"===t.choroplethScale){var u=z().limits(p,t.choroplethRangesMode,t.choroplethRanges),h=z().scale(t.choroplethColorPalette).classes(u);let r=[];u.forEach((e=>{let t={color:"",value:0},o=h(e).hex();t.color=o,t.value=e.toFixed(2),r.push(t)}));let a={layerID:t.id,choroplethParameters:i,choroplethLegend:r};o.push(a);let n={type:"FeatureCollection",features:s};const l=new x.Z({features:(new P.Z).readFeatures(n,{featureProjection:"EPSG:3857"})}),c=new S.Z({name:t.id,type:"vector",source:l,renderer:"canvas",zIndex:t.zIndex,style:function(e){if(""!==t.choroplethParameter){if(t.choroplethLabels){let r=null,o=e.get(t.choroplethParameter);r=o?o.toFixed(2):o,D.getText().setText(r+"")}else D.getText().setText("");let r=h(e.get(t.choroplethParameter)).hex();return D.getFill().setColor(r),D}return k},opacity:t.opacity});e.map.addLayer(c)}else{const r=$(p);M(r);var m=z().scale(t.choroplethColorPalette).classes(r.length);const n=[];r.forEach(((e,t)=>{let o={color:"",value:0,normVal:0};o.value=e,o.normVal=t/r.length,o.color=m(o.normVal),n.push(o)}));i=[""];a.length>0&&Object.entries(a[0].properties).forEach((e=>{const[t,r]=e;i.push(t)}));let l={layerID:t.id,choroplethParameters:i,choroplethLegend:n};o.push(l);let c={type:"FeatureCollection",features:s};const u=new x.Z({features:(new P.Z).readFeatures(c,{featureProjection:"EPSG:3857"})}),h=new S.Z({name:t.id,type:"vector",source:u,renderer:"canvas",style:function(r){const o=r.get(t.choroplethParameter);if(""!==t.choroplethParameter){if(t.choroplethLabels){let e=null,o=r.get(t.choroplethParameter);e=o||o,D.getText().setText(e+"")}else D.getText().setText("");const a=e.featureColor(o,n);return D.getFill().setColor(a),D}return k},opacity:t.opacity});e.map.addLayer(h)}})))}this.layersChoroplethProperties(o),this.map.on("moveend",(e=>{let t=e.map;this.mapCenter=t.getView().getCenter(),this.mapZoom=t.getView().getZoom();let r=t.getView().calculateExtent(),o=(0,v.$A)(r,"EPSG:3857","EPSG:4326");this.mapExtent=o})),this.loading=!1},numberWithSpaces(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g," "),t.join(".")},layersChoroplethProperties(e){this.$store.commit("layers/LAYER_CHOROPLETH_PARAMETERS",e)},featureColor(e,t){let r="#000";return t.forEach((t=>{if(t.value!=e)return"#000";r=t.color})),r}},computed:{mapCenterComputed:function(){let e=this.mapCenter,t=(0,v.bU)(e);return t},mapAreaComputed:function(){if(this.map&&this.mapZoom){let o=this.map.getView().calculateExtent(),a=(0,_.hC)(o),n=(0,_.w$)(o),s=(0,_.rL)(o),l=(0,_.Xv)(o),i=[];i.push(a,s,l,n,a);var e=new b.Z({geometry:new E.ZP([i]),name:"polygon"}),t=e.getGeometry(),r=(0,L.bg)(t)/1e6;return r}return null},mapAreaComputedFormated:function(){if(this.mapAreaComputed){let e=this.mapAreaComputed,t=e.toFixed(2);return this.numberWithSpaces(t)}return null},mapZoomAndCenter:function(){return{zoom:this.mapZoom,center:this.mapCenter}},layersSelectedVectorComputed:function(){return this.$store.state.layers.layersSelectedVector},layerSelectedRasterComputed:function(){return this.$store.state.layers.layerSelectedRaster},layerSelectedDGGSComputed:function(){return this.$store.state.layers.layersSelectedDGGS}}};var q=r(6941),I=r(8506),O=r(7518),W=r.n(O);j.render=m,j.__scopeId="data-v-deb5a672";const U=j;W()(j,"components",{QInnerLoading:q.Z,QSpinnerIos:I.Z});const Q={name:"Web-GIS",components:{Map:U},data(){return{}},mounted(){},methods:{},computed:{layersSelectedVectorComputed:function(){return this.$store.state.layers.layersSelectedVector},layerSelectedRasterComputed:function(){return this.$store.state.layers.layerSelectedRaster}}};var H=r(4379);Q.render=a;const B=Q;W()(Q,"components",{QPage:H.Z})}}]);