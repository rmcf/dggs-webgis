"use strict";(self["webpackChunkdggs_webgis"]=self["webpackChunkdggs_webgis"]||[]).push([[777],{777:(e,t,r)=>{r.r(t),r.d(t,{default:()=>X});var a=r(3673);function o(e,t,r,o,s,l){const n=(0,a.up)("Map"),i=(0,a.up)("q-page");return(0,a.wg)(),(0,a.j4)(i,{class:"q-pt-lg"},{default:(0,a.w5)((()=>[(0,a._)("div",null,[(0,a.Wm)(n)])])),_:1})}var s=r(2323);const l=e=>((0,a.dD)("data-v-29e190c6"),e=e(),(0,a.Cn)(),e),n={class:"q-pa-md"},i={class:"row"},c={class:"col-10"},p={class:"q-mb-md"},h={key:0},m=l((()=>(0,a._)("sup",null,"2",-1))),u={class:"col-2"},d={class:"flex flex-center",style:{height:"50px",position:"relative"}},w={id:"openmap",ref:"map-gis",class:"map-container"};function f(e,t,r,o,l,f){const g=(0,a.up)("q-spinner-ios"),y=(0,a.up)("q-inner-loading");return(0,a.wg)(),(0,a.iD)("div",n,[(0,a._)("div",i,[(0,a._)("div",c,[(0,a._)("div",p,[(0,a._)("div",null,"Map zoom: "+(0,s.zw)(l.mapZoom),1),l.mapArea?((0,a.wg)(),(0,a.iD)("div",h,[(0,a.Uk)("Map area: "+(0,s.zw)(l.mapArea)+" km",1),m])):(0,a.kq)("",!0),(0,a._)("div",null," Hexagons quantity: "+(0,s.zw)(l.featuresQuantity)+" at Level: "+(0,s.zw)(l.layerLevel),1)])]),(0,a._)("div",u,[(0,a._)("div",d,[(0,a.Wm)(y,{showing:l.loading},{default:(0,a.w5)((()=>[(0,a.Wm)(g,{color:"primary",size:"30px"})])),_:1},8,["showing"])])])]),(0,a._)("div",w,null,512)])}r(71),r(7098),r(5363),r(2167);var g=r(921),y=r.n(g),Z=r(8481),v=r(5140),C=r(7879),S=r(2411),x=r(3212),P=r(7263),b=r(5344),E=r(9109),_=r(6783),G=r(5149),M=r(9821),k=r(3825),R=r(5773),V=r(3489),A=r(5090),L=r(9455),T=r(1314),D=r(7434),$=r.n(D);r(4529);const z=new V.ZP({fill:new A.Z({color:"rgba(255, 255, 255, 0.6)"}),stroke:new L.Z({color:"#319FD3",width:1}),text:new T.Z({font:"12px Calibri,sans-serif",fill:new A.Z({color:"#000"}),stroke:new L.Z({color:"#fff",width:3})})}),F=new V.ZP({fill:new A.Z({color:"#fff"}),stroke:new L.Z({color:"#319FD3",width:1}),text:new T.Z({font:"12px Calibri,sans-serif",fill:new A.Z({color:"#000"}),stroke:new L.Z({color:"#fff",width:3})})}),q=new V.ZP({fill:new A.Z({color:"#fff"}),stroke:new L.Z({color:"transparent",width:0}),text:new T.Z({font:"12px Calibri,sans-serif",fill:new A.Z({color:"#000"}),stroke:new L.Z({color:"#fff",width:3})})}),W={name:"Map",components:{},data(){return{map:null,mapCenter:[2791191.1823448315,8117240.098736058],mapZoom:6,layers:[],dggsLayersFeatures:[],mapExtent:[],mapArea:null,featuresQuantity:0,layerLevel:0,loading:!1,corners:null}},watch:{layerSelectedRasterComputed(e,t){this.createMap()},layersSelectedVectorComputed(e,t){this.createMap()},layerSelectedDGGSComputed(e,t){this.createMap()},mapZoom(e,t){this.$store.commit("layers/SET_MAP_ZOOM",this.mapZoom),this.mapArea=this.mapViewArea(this.map)}},mounted(){this.createMap()},methods:{async createMap(){this.loading=!0;var e=this;document.getElementById("openmap").innerHTML="",this.layers=[],this.map=new Z.Z({target:this.$refs["map-gis"],interactions:(0,k.ce)({mouseWheelZoom:!1}),layers:[],view:new v.ZP({center:this.mapCenter,zoom:this.mapZoom,constrainResolution:!0})});const t=new C.Z({name:"osm",type:"raster",source:new S.Z({url:this.layerSelectedRasterComputed.url,attributions:this.layerSelectedRasterComputed.attributions})});e.map.addLayer(t),this.layersSelectedVectorComputed.length>0&&this.layersSelectedVectorComputed.forEach((e=>{let t=new P.Z({source:new b.Z({url:e.url,format:new E.Z}),style:function(e){return z.getText().setText(e.get("name")),z}});this.layers.push(t)}));var r=[];if(this.layerSelectedDGGSComputed.length>0){var a=this.layerSelectedDGGSComputed,o=this.mapExtent.toString();await Promise.all(a.map((async e=>{var t=[];try{t=await this.$axios.get("https://dggs-api-bozea3cspa-ew.a.run.app/dggs-api/collections/"+e.id+"/zones",{params:{resolution:e.level,limit:1e4,bbox:o},headers:{"Content-Type":"application/json"}})}catch(g){this.loading=!1,console.log("error ",g.message)}let a=t.data.features;var s=[],l=[];a.forEach((t=>{let r=y().h3ToFeature(t.id);Object.entries(t.properties).forEach((e=>{const[t,a]=e;r.properties[t]=a})),s.push(r),l.push(t.properties[e.choroplethParameter])}));var n=[""];Object.entries(a[0].properties).forEach((e=>{const[t,r]=e;n.push(t)}));var i=l.sort(),c=i.filter((function(e){return e>0})),p=$().limits(c,e.choroplethRangesMode,e.choroplethRanges),h=$().scale(e.choroplethColorPalette).classes(p);this.featuresQuantity=s.length,this.layerLevel=e.level;let m=[];p.forEach((e=>{let t={color:"",value:0},r=h(e).hex();t.color=r,t.value=e,m.push(t)}));let u={type:"FeatureCollection",features:s};const d=new b.Z({features:(new E.Z).readFeatures(u,{featureProjection:"EPSG:3857"})}),w=new P.Z({name:e.id,type:"vector",source:d,style:function(t){if(""!==e.choroplethParameter){let r=t.get(e.choroplethParameter).toFixed(2);q.getText().setText(r);let a=h(t.get(e.choroplethParameter)).hex();return q.getFill().setColor(a),q}return F.getText().setText(t.get(e.choroplethParameter)),F},opacity:e.opacity});this.layers.push(w);let f={layerID:e.id,choroplethParameters:n,choroplethLegend:m};r.push(f)})))}this.layersChoroplethProperties(r),this.layers.forEach((t=>{e.map.addLayer(t)})),this.mapArea=this.mapViewArea(this.map),this.map.on("moveend",(e=>{let t=e.map;this.mapCenter=t.getView().getCenter(),this.mapZoom=t.getView().getZoom();let r=t.getView().calculateExtent(),a=(0,x.$A)(r,"EPSG:3857","EPSG:4326");this.mapExtent=a})),this.loading=!1},numberWithSpaces(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g," "),t.join(".")},layersChoroplethProperties(e){this.$store.commit("layers/LAYER_CHOROPLETH_PARAMETERS",e)},mapViewArea(e){let t=e.getView().calculateExtent(),r=(0,R.hC)(t),a=(0,R.w$)(t),o=(0,R.rL)(t),s=(0,R.Xv)(t),l=[];l.push(r,o,s,a,r);var n=new _.Z({geometry:new G.ZP([l]),name:"polygon"}),i=n.getGeometry(),c=(0,M.bg)(i)/1e6;let p=this.numberWithSpaces(c.toFixed(2));return p}},computed:{mapCenterComputed:function(){let e=this.mapCenter,t=(0,x.bU)(e);return t},layersSelectedVectorComputed:function(){return this.$store.state.layers.layersSelectedVector},layerSelectedRasterComputed:function(){return this.$store.state.layers.layerSelectedRaster},layerSelectedDGGSComputed:function(){return this.$store.state.layers.layersSelectedDGGS}}};var j=r(6941),I=r(8506),O=r(7518),Q=r.n(O);W.render=f,W.__scopeId="data-v-29e190c6";const H=W;Q()(W,"components",{QInnerLoading:j.Z,QSpinnerIos:I.Z});const B={name:"Web-GIS",components:{Map:H},data(){return{}},mounted(){},methods:{},computed:{layersSelectedVectorComputed:function(){return this.$store.state.layers.layersSelectedVector},layerSelectedRasterComputed:function(){return this.$store.state.layers.layerSelectedRaster}}};var U=r(4379);B.render=o;const X=B;Q()(B,"components",{QPage:U.Z})}}]);