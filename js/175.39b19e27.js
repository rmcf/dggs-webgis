"use strict";(self["webpackChunkdggs_webgis"]=self["webpackChunkdggs_webgis"]||[]).push([[175],{1175:(e,t,r)=>{r.r(t),r.d(t,{default:()=>B});var a=r(3673);function o(e,t,r,o,s,l){const n=(0,a.up)("Map"),i=(0,a.up)("q-page");return(0,a.wg)(),(0,a.j4)(i,{class:"q-pt-lg"},{default:(0,a.w5)((()=>[(0,a._)("div",null,[(0,a.Wm)(n)])])),_:1})}var s=r(2323);const l=e=>((0,a.dD)("data-v-e8c720d0"),e=e(),(0,a.Cn)(),e),n={class:"q-pa-md"},i={class:"row"},p={class:"col-10"},c={class:"q-mb-md"},u=l((()=>(0,a._)("sup",null,"2",-1))),m={class:"col-2"},d={class:"flex flex-center",style:{height:"50px",position:"relative"}},h={id:"openmap",ref:"map-gis",class:"map-container"};function f(e,t,r,o,l,f){const g=(0,a.up)("q-spinner-ios"),w=(0,a.up)("q-inner-loading");return(0,a.wg)(),(0,a.iD)("div",n,[(0,a._)("div",i,[(0,a._)("div",p,[(0,a._)("div",c,[(0,a._)("div",null,"Map zoom: "+(0,s.zw)(l.mapZoom),1),(0,a._)("div",null,[(0,a.Uk)("Map area: "+(0,s.zw)(f.mapAreaComputedFormated)+" km",1),u]),(0,a._)("div",null," Hexagons quantity: "+(0,s.zw)(l.featuresQuantity)+" at Level: "+(0,s.zw)(l.layerLevel),1)])]),(0,a._)("div",m,[(0,a._)("div",d,[(0,a.Wm)(w,{showing:l.loading},{default:(0,a.w5)((()=>[(0,a.Wm)(g,{color:"primary",size:"30px"})])),_:1},8,["showing"])])])]),(0,a._)("div",h,null,512)])}r(71),r(7098),r(5363),r(2167);var g=r(921),w=r.n(g),y=r(3081),C=r(5140),v=r(7879),Z=r(2411),S=r(3212),x=r(7263),P=r(5344),b=r(9109),_=r(6783),E=r(5149),A=r(9821),M=r(5773),G=r(3489),L=r(5090),R=r(9455),k=r(1314),T=r(7434),$=r.n(T);r(4529);const F=new G.ZP({fill:new L.Z({color:"rgba(255, 255, 255, 0.6)"}),stroke:new R.Z({color:"#319FD3",width:1}),text:new k.Z({font:"12px Calibri,sans-serif",fill:new L.Z({color:"#000"}),stroke:new R.Z({color:"#fff",width:3})})}),V=new G.ZP({fill:new L.Z({color:"#fff"}),stroke:new R.Z({color:"#319FD3",width:1}),text:new k.Z({font:"12px Calibri,sans-serif",fill:new L.Z({color:"#000"}),stroke:new R.Z({color:"#fff",width:3})})}),D=new G.ZP({fill:new L.Z({color:"#fff"}),stroke:new R.Z({color:"transparent",width:0}),text:new k.Z({font:"8px Calibri,sans-serif",fill:new L.Z({color:"#000"}),stroke:new R.Z({color:"#fff",width:3})})}),z={name:"Map",components:{},data(){return{map:null,mapCenter:[2791191.1823448315,8117240.098736058],mapZoom:6,mapExtent:[],mapArea:null,layers:[],dggsLayersFeatures:[],featuresQuantity:0,layerLevel:0,corners:null,loading:!1}},watch:{layerSelectedRasterComputed(e,t){this.createMap()},layersSelectedVectorComputed(e,t){this.createMap()},layerSelectedDGGSComputed(e,t){this.createMap()},mapAreaComputed(e,t){this.$store.commit("layers/SET_MAP_ZOOM",this.mapZoom),this.$store.commit("layers/MAP_AREA",this.mapAreaComputed)}},mounted(){this.createMap()},methods:{async createMap(){this.loading=!0,this.map=null;var e=this;document.getElementById("openmap").innerHTML="",this.map=new y.Z({target:this.$refs["map-gis"],layers:[],view:new C.ZP({center:this.mapCenter,zoom:this.mapZoom,constrainResolution:!0})});const t=new v.Z({name:"osm",type:"raster",source:new Z.Z({url:this.layerSelectedRasterComputed.url,attributions:this.layerSelectedRasterComputed.attributions})});e.map.addLayer(t),this.layersSelectedVectorComputed.length>0&&this.layersSelectedVectorComputed.forEach((t=>{let r=new x.Z({source:new P.Z({url:t.url,format:new b.Z}),style:function(e){return F.getText().setText(e.get("name")),F}});console.log("1 vector layer"),e.map.addLayer(r)}));var r=[];if(this.layerSelectedDGGSComputed.length>0){var a=this.layerSelectedDGGSComputed,o=this.mapExtent.toString();await Promise.all(a.map((async t=>{var a=[];try{a=await this.$axios.get("https://dggs-api-bozea3cspa-ew.a.run.app/dggs-api/collections/"+t.id+"/zones",{params:{resolution:t.level,limit:1e4,bbox:o},headers:{"Content-Type":"application/json"}})}catch(C){this.loading=!1,console.log("error ",C.message)}let s=a.data.features;var l=[],n=[];s.forEach((e=>{let r=w().h3ToFeature(e.id);Object.entries(e.properties).forEach((e=>{const[t,a]=e;r.properties[t]=a})),l.push(r),n.push(e.properties[t.choroplethParameter])}));var i=[""];s.length>0&&Object.entries(s[0].properties).forEach((e=>{const[t,r]=e;i.push(t)}));var p=n.sort(),c=p.filter((function(e){return e>0})),u=$().limits(c,t.choroplethRangesMode,t.choroplethRanges),m=$().scale(t.choroplethColorPalette).classes(u);this.featuresQuantity=l.length,this.layerLevel=t.level;let d=[];u.forEach((e=>{let t={color:"",value:0},r=m(e).hex();t.color=r,t.value=e,d.push(t)}));let h={type:"FeatureCollection",features:l};const f=new P.Z({features:(new b.Z).readFeatures(h,{featureProjection:"EPSG:3857"})}),g=new x.Z({name:t.id,type:"vector",source:f,style:function(e){if(""!==t.choroplethParameter){let r=e.get(t.choroplethParameter),a=null;a=r?r.toFixed(2):r,t.choroplethLabels&&D.getText().setText(a+"");let o=m(e.get(t.choroplethParameter)).hex();return D.getFill().setColor(o),D}return V.getText().setText(e.get(t.choroplethParameter)),V},opacity:t.opacity});e.map.addLayer(g);let y={layerID:t.id,choroplethParameters:i,choroplethLegend:d};r.push(y)})))}this.layersChoroplethProperties(r),this.map.on("moveend",(e=>{let t=e.map;this.mapCenter=t.getView().getCenter(),this.mapZoom=t.getView().getZoom();let r=t.getView().calculateExtent(),a=(0,S.$A)(r,"EPSG:3857","EPSG:4326");this.mapExtent=a})),this.loading=!1},numberWithSpaces(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g," "),t.join(".")},layersChoroplethProperties(e){this.$store.commit("layers/LAYER_CHOROPLETH_PARAMETERS",e)}},computed:{mapCenterComputed:function(){let e=this.mapCenter,t=(0,S.bU)(e);return t},mapAreaComputed:function(){if(this.map&&this.mapZoom){let a=this.map.getView().calculateExtent(),o=(0,M.hC)(a),s=(0,M.w$)(a),l=(0,M.rL)(a),n=(0,M.Xv)(a),i=[];i.push(o,l,n,s,o);var e=new _.Z({geometry:new E.ZP([i]),name:"polygon"}),t=e.getGeometry(),r=(0,A.bg)(t)/1e6;return r}return null},mapAreaComputedFormated:function(){if(this.mapAreaComputed){let e=this.mapAreaComputed,t=e.toFixed(2);return this.numberWithSpaces(t)}return null},layersSelectedVectorComputed:function(){return this.$store.state.layers.layersSelectedVector},layerSelectedRasterComputed:function(){return this.$store.state.layers.layerSelectedRaster},layerSelectedDGGSComputed:function(){return this.$store.state.layers.layersSelectedDGGS}}};var q=r(6941),j=r(8506),I=r(7518),O=r.n(I);z.render=f,z.__scopeId="data-v-e8c720d0";const Q=z;O()(z,"components",{QInnerLoading:q.Z,QSpinnerIos:j.Z});const W={name:"Web-GIS",components:{Map:Q},data(){return{}},mounted(){},methods:{},computed:{layersSelectedVectorComputed:function(){return this.$store.state.layers.layersSelectedVector},layerSelectedRasterComputed:function(){return this.$store.state.layers.layerSelectedRaster}}};var H=r(4379);W.render=o;const B=W;O()(W,"components",{QPage:H.Z})}}]);